# 검색어 자동완성 시스템

## Trie Data Structure

> Trie를 활용해 검색어를 포함하는 가장 인기있는 5개의 키워드를 추출한다

- 트리의 루트 노드는 빈 문자열을 나타냄
- 각 노드는 글자 하나를 저장하고 알파벳 기준으로 26개의 자식 노드(해당 글자 다음에 등장할 수 있는 모든 글자)를 가질 수 있음
- 각 노드는 하나의 단어 또는 접두어(prefix)를 나타냄

### 시간 복잡도

> 가장 많이 사용된 질의어 K개를 찾을 때의 시간 복잡도를 계산해보자

```
p: 접두어(prefix)의 길이
n: 트라이 안에 있는 노드 개수
c: 주어진 노드의 자식 노드 개수
```

1. 질의 접두어를 표현하는 노드를 찾기 => `O(p)`
   - 접두어 노드 "fe" 찾기
2. 찾은 노드의 하위 트리를 탐색해 모든 유효 노드를 찾기 => `O(c)`
   - [fear: 10, feast: 35, fair: 29]
3. 유효 노드를 정렬하여 k개의 가장 인기있는 검색어 찾기 => `O(clogc)` 
   - [feast: 35, fair: 29] 

=> O(p) + O(c) + O(clogc)

### 알고리즘 개선 방법

1. 접두어의 최대 길이 제한 => `O(1)`
2. 각 노드에 인기 검색어를 캐시 => `O(1)`

=> O(1)

## 데이터 수집 서비스

> 트라이를 자주 갱신할 필요가 있을까?

- 사용자가 검색창에 타이핑을 할 때마다 실시간으로 트라이를 갱신하는 방식은 질의 서비스 부하를 야기함
- 테이터 분석 서비스 로그 > 로그 취합 서버 > 취합된 데이터 > 작업 서버 > 트라이 데이터베이스 > 트라이 캐시
  - 작업 서버가 트라이 데이터베이스 갱신 주기를 1주 단위를 가져가 트라이 갱신이 너무 자주 일어나지 않도록 할 수 있음
  - 트라이 데이터 베이스로는 문서 저장소(document store)나 키-값 저장소를 활용할 수 있음

## 질의 서비스

> 질의 서비스를 번개처럼 빠르게 하려면 캐싱을 활용하자!

- 대부분의 애플리케이션에서 자동완성 검색어 제안 결과는 짧은 시간 안에 자주 바뀌지 않음
- 따라서 제안된 검색어들을 캐시에 넣어두면 동일한 후속 질의 결과에 대해서는 바로 캐시에서 값을 가져올 수 있음
- 구글도 검색어를 1시간 정도 캐시해둔다 (cache-control: private, max-age=3600)