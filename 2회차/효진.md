## Chapter3

### 쿠폰 보내는 프로그램 리팩토링

> 쿠폰 추천 정책에 따라 사용자에게 맞는 쿠폰을 보내는 프로그램을 만들어주세요.
> 추천 정책 : 10명 이상 추천한 사용자는 더 좋은 쿠폰을 받을 수 있습니다.

<details>
<summary>AS-IS</summary>
<div>

```jsx
const subscriber = {
    email: 'gywls00100@gmail.com',
    rec_count: 19,
}

const rank1 = 'best'
const rank2 = 'good'

function subCouponRank(subscriber) {
    if (subscriber.rec_count >= 10) return 'best'
    else return 'good'
}

const coupon = {
    code: '10PERCENT',
    rank: 'bad',
}

function selectCouponsByRank(coupons, rank) {
    const ret = []
    for (let c = 0; c < coupons.length; c++) {
        const coupon = coupons[c]
        if (coupon.rank === rank) ret.push(coupon.code)
    }
    return ret
}

const message = {
    from: 'newsletter@coupondog.co',
    to: 'sam@pmail.com',
    subject: 'Your weekly coupons inside',
    body: 'Here are your coupons ...',
}

function emailForSubscriber(subscriber, goods, bests) {
    const rank = subCouponRank(subscriber)
    if (rank === 'best')
        return {
            from: 'newsletter@coupondog.co',
            to: subscriber.email,
            subject: 'Your best weekly coupons inside',
            body: 'Here are the best coupons: ' + bests.join(', '),
        }
    // rank === "good"
    else
        return {
            from: 'newsletter@coupondog.co',
            to: subscriber.email,
            subject: 'Your good weekly coupons inside',
            body: 'Here are the good coupons: ' + goods.join(', '),
        }
}

function emailsForSubscribers(subscribers, goods, bests) {
    const emails = []
    for (let s = 0; s < subscribers.length; s++) {
        const subscriber = subscribers[s]
        const email = emailForSubscriber(subscriber, goods, bests)
        emails.push(email)
    }
    return emails
}

function sendIssue() {
    const coupons = fetchCouponsFromDB()
    const goodCoupons = selectCouponsByRank(coupons, 'good')
    const bestCoupons = selectCouponsByRank(coupons, 'best')
    const subscribers = fetchSubscribersFromDB()
    const emails = emailsForSubscribers(subscribers, goodCoupons, bestCoupons)
    for (let e = 0; e < emails.length; e++) {
        const email = emails[e]
        emailSystem.send(email)
    }
}
```

</div>
</details>

<details>
<summary>TO-BE</summary>
<div>

```jsx
// 데이터
const subscriber = {
    email: 'gywls00100@gmail.com',
    rec_count: 19,
}

// 데이터
const rank1 = 'best'
const rank2 = 'good'

// 계산 - 어떤 구독자가 어떤 등급의 쿠폰 받을지 결정
function subCouponRank(subscriber) {
    if (subscriber.rec_count >= 10) return 'best'
    else return 'good'
}

// 데이터
const coupon = {
    code: '10PERCENT',
    rank: 'bad',
}

// 계산 - 특정 등급의 쿠폰 목록 선택
function selectCouponsByRank(coupons, rank) {
    return coupons.map(coupon => coupon.rank === rank)
}

// 데이터
const message = {
    from: 'newsletter@coupondog.co',
    to: 'sam@pmail.com',
    subject: 'Your weekly coupons inside',
    body: 'Here are your coupons ...',
}

// 계산 - 구독자가 받을 이메일 만들기
function emailForSubscriber(subscriber, goods, bests) {
    const rank = subCouponRank(subscriber)
    if (rank === 'best')
        return {
            from: 'newsletter@coupondog.co',
            to: subscriber.email,
            subject: 'Your best weekly coupons inside',
            body: 'Here are the best coupons: ' + bests.join(', '),
        }
    // rank === "good"
    else
        return {
            from: 'newsletter@coupondog.co',
            to: subscriber.email,
            subject: 'Your good weekly coupons inside',
            body: 'Here are the good coupons: ' + goods.join(', '),
        }
}

// 계산 - 구독자 목록으로 전체 이메일 목록 만들기
function emailsForSubscribers(subscribers, goods, bests) {
    return subscribers.map(subscriber => emailForSubscriber(subscriber, goods, bests))
}

function sendIssue() {
    // 액션 - DB에서 쿠폰 목록 가져오기
    const coupons = fetchCouponsFromDB()
    // 액션 - DB에서 구독자 목록 가져오기
    const subscribers = fetchSubscribersFromDB()
    // 액션 - 등급별 쿠폰 목록 가져오기
    const goodCoupons = selectCouponsByRank(coupons, 'good')
    const bestCoupons = selectCouponsByRank(coupons, 'best')
    // 액션 - 이메일 목록 만들기
    const emails = emailsForSubscribers(subscribers, goodCoupons, bestCoupons)
    // 액션 - 이메일 보내기
    emails.forEach(email => emailSystem.send(email))
}
```

</div>
</details>

## Chapter4

### 연습문제1

```jsx
function addItem(cart, name, price) {
    return [...cart, { name, price }];
}

function addItemToCart(naem, price) {
    // 얘도 전역 변수를 발라낼 여지가 있어보인다
    shoppingCart = addItem(shoppingCart, name, price);
    calcCartTotal();
}
```

### 연습문제2
```jsx
function calcTax(amount, taxRate) {
    return amount * taxRate;
}

// update 하는 함수 자체가 함수형스럽지는 않아보인다
function updateTaxDom() {
    setTaxDom(calcTax(shoppingCartTotal, 0.1));
}
```

### 연습문제3
```jsx
function isFreeShipping(itemPrice, total) {
    return (itemPrice + total) >= 20;    
}

function updateShippingIcons() {
    const buyButtons = getBuyButtonsDom();
    buyButtons.forEach((buyButton =>
        isFreeShipping(buyButton.item.price, shoppingCartTotal)
            ? button.showFreeShippingIcon() 
            : button.hideFreeShippingIcon()));
}
```